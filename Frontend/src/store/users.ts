import axios from '@/plugins/axios'
import proxyUrls from '@/constants/proxyUrls'
type AnyObj = Record<string, unknown>
type CommitFn = (mutation: string, payload?: unknown) => void
type ActionCtx = { commit: CommitFn; dispatch?: (action: string) => void }
interface State { roles: AnyObj[]; admins: AnyObj[] }
export default { namespaced: true, state: { roles: [], admins: [] } as State, actions: { async getRoles({ commit }: ActionCtx) { try { const { data } = await axios.get(proxyUrls.roles); if (data) commit('setRoles', data) } catch (err) { console.log('Error', err) } }, async getAdmins({ commit }: ActionCtx) { try { const { data } = await axios.get(proxyUrls.allAdmins); if (data) commit('setAdmins', data) } catch (err) { throw err } }, async addAdmin({ dispatch }: ActionCtx, admin: AnyObj) { try { const { data } = await axios.post(proxyUrls.addAdmin, admin); if (data) { dispatch?.('getAdmins'); return true } return false } catch (err) { throw err } }, async editAdmin({ dispatch }: ActionCtx, admin: AnyObj) { try { const { data } = await axios.put(proxyUrls.editAdmin, admin); if (data) { dispatch?.('getAdmins'); return true } return false } catch (err) { throw err } }, async deleteAdmin({ dispatch }: ActionCtx, email: string) { try { await axios.delete(proxyUrls.deleteAdmin, { data: { email } }); dispatch?.('getAdmins') } catch (err) { console.log('Error', err) } } }, mutations: { setRoles(state: State, payload: AnyObj[]) { state.roles = payload }, setAdmins(state: State, payload: AnyObj[]) { state.admins = payload } }, getters: { getRoles: (state: State) => state.roles, getAdmins: (state: State) => state.admins } }