import { createStore } from 'vuex'
import axios from '@/plugins/axios'
import proxyUrls from '@/constants/proxyUrls'
type AnyObj = Record<string, unknown>
type CommitFn = (mutation: string, payload?: unknown) => void
type ActionCtx = { commit: CommitFn; state: State }
interface State { orders: AnyObj[]; orderStatus: string; pagination: { page: number; total: number; limit: number }; openOrder: AnyObj | null }
export default createStore({ namespaced: true, state: { orders: [], orderStatus: '', pagination: { page: 1, total: 0, limit: 10 }, openOrder: null } as State, mutations: { setOpenOrder(state: State, order: AnyObj) { state.openOrder = order }, setOrderStatus(state: State, val: string) { state.orderStatus = val }, setOrderDetails(state: State, payload: AnyObj) { const p = payload as AnyObj; if (p.rows && Array.isArray(p.rows)) { state.orders = p.rows as AnyObj[] } state.pagination = { total: (p.count as number) || 0, limit: (p.limit as number) || 10, page: (p.page as number) || 1 } } }, actions: { async getOrdersByStatus({ commit, state }: ActionCtx, status: string) { try { const { data } = await axios.get(proxyUrls.getOrders, { params: { status, limit: state.pagination.limit, page: state.pagination.page } }); commit('setOrderDetails', data); commit('setOrderStatus', status) } catch (error) { throw error } }, async openOrderDetail({ commit }: ActionCtx, order: AnyObj) { const ord = order as AnyObj & { id?: string }; const id = ord.id; if (!id) return false; try { const { data } = await axios.get(`${proxyUrls.getOrderById}/${id}`); if (data) { commit('setOpenOrder', data); return true } return false } catch (error) { throw error } }, async confirmOrder({ commit, state }: ActionCtx) { if (!state.openOrder) return false; const oid = (state.openOrder as AnyObj & { id?: string }).id; if (!oid) return false; try { const { data } = await axios.put(`${proxyUrls.updateOrderStatus}/${oid}/status`, { status: 'CONFIRMED' }); commit('setOpenOrder', data); return true } catch (error) { throw error } }, async cancelOrder({ commit }: ActionCtx, orderId: string) { try { const { data } = await axios.put(`${proxyUrls.updateOrderStatus}/${orderId}/status`, { status: 'CANCELLED' }); commit('setOpenOrder', data); return true } catch (error) { throw error } }, async fulfillItem({ commit }: ActionCtx, payload: AnyObj) { try { const p = payload as AnyObj; const { data } = await axios.post(proxyUrls.fulfillOrder, p.fulfillmentDetail as unknown); commit('setOpenOrder', data); return true } catch (error) { throw error } } }, getters: { orderStatus: (state: State) => state.orderStatus, orders: (state: State) => state.orders, openOrder: (state: State) => state.openOrder, pagination: (state: State) => state.pagination } })